<!DOCTYPE html>
<html lang="ja">
<head>
  <title>CSSèª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ - æ°´é“ãƒ¡ãƒ¼ã‚¿ãƒ¼èª­ã¿å–ã‚Šã‚¢ãƒ—ãƒª</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <style>
    /* Critical CSS */
    * { box-sizing: border-box; }
    body { 
      margin: 0; padding: 20px; 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      line-height: 1.6; background-color: #f5f5f5;
    }
    .test-container {
      max-width: 800px; margin: 0 auto;
      background: white; padding: 20px; border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .test-result {
      margin: 10px 0; padding: 10px;
      border-radius: 4px; border-left: 4px solid #007bff;
      background-color: #f8f9fa;
    }
    .success { border-left-color: #28a745; background-color: #d4edda; }
    .warning { border-left-color: #ffc107; background-color: #fff3cd; }
    .error { border-left-color: #dc3545; background-color: #f8d7da; }
    .metric { display: inline-block; margin: 5px 10px; font-weight: bold; }
    button {
      padding: 10px 20px; margin: 5px;
      border: 1px solid #007bff; border-radius: 4px;
      background-color: #007bff; color: white;
      cursor: pointer; transition: background-color 0.2s;
    }
    button:hover { background-color: #0056b3; }
    .styles-loading { opacity: 0; transition: opacity 0.3s ease-in-out; }
    .styles-loaded { opacity: 1; }
  </style>

  <!-- ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®CSSãƒ•ã‚¡ã‚¤ãƒ« -->
  <link rel="stylesheet" href="css_styles/property_select.css?v=20250614c">
  <link rel="stylesheet" href="css_styles/pwa-styles.css?v=20250614c">
</head>
<body>
  <div class="test-container">
    <h1>CSSèª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆçµæœ</h1>
    <p>æ°´é“ãƒ¡ãƒ¼ã‚¿ãƒ¼èª­ã¿å–ã‚Šã‚¢ãƒ—ãƒªã®CSSèª­ã¿è¾¼ã¿ä¿®æ­£ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚</p>
    
    <div id="test-results"></div>
    
    <button onclick="runCSSLoadTest()">CSSèª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ</button>
    <button onclick="testPagePerformance()">ãƒšãƒ¼ã‚¸ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ</button>
    <button onclick="testStyleTransition()">ã‚¹ã‚¿ã‚¤ãƒ«é·ç§»ãƒ†ã‚¹ãƒˆ</button>
    <button onclick="clearResults()">çµæœã‚’ã‚¯ãƒªã‚¢</button>
    
    <h2>å„ãƒšãƒ¼ã‚¸ã¸ã®ãƒªãƒ³ã‚¯</h2>
    <ul>
      <li><a href="property_select.html" target="_blank">ç‰©ä»¶é¸æŠãƒšãƒ¼ã‚¸</a></li>
      <li><a href="room_select.html" target="_blank">éƒ¨å±‹é¸æŠãƒšãƒ¼ã‚¸</a></li>
      <li><a href="meter_reading.html" target="_blank">ãƒ¡ãƒ¼ã‚¿ãƒ¼èª­ã¿å–ã‚Šãƒšãƒ¼ã‚¸</a></li>
    </ul>
  </div>

  <script>
    const resultsContainer = document.getElementById('test-results');
    let testStartTime = performance.now();

    function addResult(message, type = 'test-result') {
      const div = document.createElement('div');
      div.className = `test-result ${type}`;
      div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
      resultsContainer.appendChild(div);
      resultsContainer.scrollTop = resultsContainer.scrollHeight;
    }

    // CSSèª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
    function runCSSLoadTest() {
      addResult('CSSèª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...', 'test-result');
      
      const startTime = performance.now();
      let cssLoaded = false;
      let attempts = 0;
      const maxAttempts = 100;
      
      function checkCSSLoaded() {
        attempts++;
        
        // è¨ˆç®—ã•ã‚ŒãŸã‚¹ã‚¿ã‚¤ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯
        const testElement = document.createElement('div');
        testElement.className = 'mantine-button';
        testElement.style.position = 'absolute';
        testElement.style.visibility = 'hidden';
        document.body.appendChild(testElement);
        
        const computedStyle = window.getComputedStyle(testElement);
        const hasButtonStyles = computedStyle.backgroundColor !== 'rgba(0, 0, 0, 0)' && 
                               computedStyle.backgroundColor !== 'transparent';
        
        document.body.removeChild(testElement);
        
        if (hasButtonStyles) {
          cssLoaded = true;
          const loadTime = performance.now() - startTime;
          addResult(`âœ… CSSèª­ã¿è¾¼ã¿æˆåŠŸ! (${loadTime.toFixed(2)}ms, ${attempts}å›ç›®ã®ç¢ºèª)`, 'success');
          
          // è©³ç´°æƒ…å ±
          addResult(`ğŸ“Š CSSèª­ã¿è¾¼ã¿è©³ç´°: 
            <span class="metric">èª­ã¿è¾¼ã¿æ™‚é–“: ${loadTime.toFixed(2)}ms</span>
            <span class="metric">ç¢ºèªå›æ•°: ${attempts}</span>
            <span class="metric">å¹³å‡ç¢ºèªé–“éš”: ${(loadTime/attempts).toFixed(2)}ms</span>`, 'test-result');
          
        } else if (attempts >= maxAttempts) {
          addResult(`âŒ CSSèª­ã¿è¾¼ã¿ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ (${maxAttempts}å›ç¢ºèªå¾Œ)`, 'error');
        } else {
          setTimeout(checkCSSLoaded, 10);
        }
      }
      
      checkCSSLoaded();
    }

    // ãƒšãƒ¼ã‚¸ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
    function testPagePerformance() {
      addResult('ãƒšãƒ¼ã‚¸ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...', 'test-result');
      
      if (window.performance && window.performance.timing) {
        const timing = window.performance.timing;
        const navigation = window.performance.navigation;
        
        const domContentLoaded = timing.domContentLoadedEventEnd - timing.navigationStart;
        const pageLoad = timing.loadEventEnd - timing.navigationStart;
        const domInteractive = timing.domInteractive - timing.navigationStart;
        const firstPaint = performance.getEntriesByType('paint')[0]?.startTime || 0;
        
        addResult(`ğŸ“ˆ ãƒšãƒ¼ã‚¸ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™:
          <span class="metric">DOMèª­ã¿è¾¼ã¿: ${domContentLoaded}ms</span>
          <span class="metric">ãƒšãƒ¼ã‚¸å®Œäº†: ${pageLoad}ms</span>
          <span class="metric">DOMå¯¾è©±å¯èƒ½: ${domInteractive}ms</span>
          <span class="metric">åˆå›æç”»: ${firstPaint.toFixed(2)}ms</span>
          <span class="metric">ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ç¨®åˆ¥: ${navigation.type === 0 ? 'é€šå¸¸' : navigation.type === 1 ? 'ãƒªãƒ­ãƒ¼ãƒ‰' : 'ãã®ä»–'}</span>`, 'test-result');
          
        // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è©•ä¾¡
        if (domContentLoaded < 1000) {
          addResult('âœ… DOMèª­ã¿è¾¼ã¿é€Ÿåº¦: é«˜é€Ÿ (<1ç§’)', 'success');
        } else if (domContentLoaded < 3000) {
          addResult('âš ï¸ DOMèª­ã¿è¾¼ã¿é€Ÿåº¦: æ™®é€š (1-3ç§’)', 'warning');
        } else {
          addResult('âŒ DOMèª­ã¿è¾¼ã¿é€Ÿåº¦: ä½é€Ÿ (>3ç§’)', 'error');
        }
      } else {
        addResult('âŒ Performance APIãŒåˆ©ç”¨ã§ãã¾ã›ã‚“', 'error');
      }
    }

    // ã‚¹ã‚¿ã‚¤ãƒ«é·ç§»ãƒ†ã‚¹ãƒˆ
    function testStyleTransition() {
      addResult('ã‚¹ã‚¿ã‚¤ãƒ«é·ç§»ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...', 'test-result');
      
      const testDiv = document.createElement('div');
      testDiv.className = 'styles-loading';
      testDiv.style.position = 'absolute';
      testDiv.style.top = '-1000px';
      testDiv.innerHTML = 'ãƒ†ã‚¹ãƒˆè¦ç´ ';
      document.body.appendChild(testDiv);
      
      const initialOpacity = window.getComputedStyle(testDiv).opacity;
      addResult(`ğŸ” åˆæœŸé€æ˜åº¦: ${initialOpacity}`, 'test-result');
      
      // styles-loadedã‚¯ãƒ©ã‚¹ã«å¤‰æ›´
      setTimeout(() => {
        testDiv.className = 'styles-loaded';
        
        setTimeout(() => {
          const finalOpacity = window.getComputedStyle(testDiv).opacity;
          addResult(`ğŸ” æœ€çµ‚é€æ˜åº¦: ${finalOpacity}`, 'test-result');
          
          if (initialOpacity === '0' && finalOpacity === '1') {
            addResult('âœ… ã‚¹ã‚¿ã‚¤ãƒ«é·ç§»ãƒ†ã‚¹ãƒˆæˆåŠŸ!', 'success');
          } else {
            addResult('âŒ ã‚¹ã‚¿ã‚¤ãƒ«é·ç§»ãƒ†ã‚¹ãƒˆå¤±æ•—', 'error');
          }
          
          document.body.removeChild(testDiv);
        }, 500);
      }, 100);
    }

    function clearResults() {
      resultsContainer.innerHTML = '';
    }

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
    window.addEventListener('DOMContentLoaded', () => {
      const loadTime = performance.now() - testStartTime;
      addResult(`ğŸš€ ãƒšãƒ¼ã‚¸DOMContentLoaded (${loadTime.toFixed(2)}ms)`, 'success');
      
      // CSSèª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆã‚’è‡ªå‹•å®Ÿè¡Œ
      setTimeout(runCSSLoadTest, 100);
    });

    window.addEventListener('load', () => {
      const loadTime = performance.now() - testStartTime;
      addResult(`ğŸ ãƒšãƒ¼ã‚¸å®Œå…¨èª­ã¿è¾¼ã¿å®Œäº† (${loadTime.toFixed(2)}ms)`, 'success');
    });

    // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
    window.addEventListener('error', (e) => {
      addResult(`âŒ JavaScriptã‚¨ãƒ©ãƒ¼: ${e.message}`, 'error');
    });
  </script>
</body>
</html>
