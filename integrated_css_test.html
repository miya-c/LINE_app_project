<!DOCTYPE html>
<html lang="ja">
<head>
  <title>çµ±åˆCSSèª­ã¿è¾¼ã¿æ¤œè¨¼ãƒ„ãƒ¼ãƒ«</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <style>
    body { 
      margin: 0; padding: 20px; 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      background-color: #f5f5f5;
    }
    .container {
      max-width: 1200px; margin: 0 auto;
      background: white; padding: 20px; border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .test-grid {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 20px; margin: 20px 0;
    }
    .test-card {
      background: #f8f9fa; padding: 20px; border-radius: 8px;
      border-left: 4px solid #007bff;
    }
    .test-card h3 { margin-top: 0; color: #007bff; }
    .test-result {
      margin: 10px 0; padding: 10px; border-radius: 4px;
      background-color: #fff; border-left: 3px solid #28a745;
      font-family: monospace; font-size: 14px;
    }
    .error { border-left-color: #dc3545; background-color: #f8d7da; }
    .warning { border-left-color: #ffc107; background-color: #fff3cd; }
    .success { border-left-color: #28a745; background-color: #d4edda; }
    button {
      padding: 8px 16px; margin: 5px;
      border: 1px solid #007bff; border-radius: 4px;
      background-color: #007bff; color: white;
      cursor: pointer; transition: all 0.2s;
    }
    button:hover { background-color: #0056b3; }
    .link-button {
      display: inline-block; padding: 8px 16px; margin: 5px;
      background-color: #6c757d; color: white; text-decoration: none;
      border-radius: 4px; transition: all 0.2s;
    }
    .link-button:hover { background-color: #545b62; }
    iframe {
      width: 100%; height: 300px; border: 1px solid #ddd;
      border-radius: 4px; margin: 10px 0;
    }
    .status-indicator {
      display: inline-block; width: 10px; height: 10px;
      border-radius: 50%; margin-right: 8px;
    }
    .status-ok { background-color: #28a745; }
    .status-warning { background-color: #ffc107; }
    .status-error { background-color: #dc3545; }
    .metrics {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px; margin: 15px 0;
    }
    .metric {
      background: white; padding: 10px; border-radius: 4px;
      text-align: center; border: 1px solid #ddd;
    }
    .metric-value { font-size: 20px; font-weight: bold; color: #007bff; }
    .metric-label { font-size: 12px; color: #6c757d; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ§ª æ°´é“ãƒ¡ãƒ¼ã‚¿ãƒ¼èª­ã¿å–ã‚Šã‚¢ãƒ—ãƒª - CSSèª­ã¿è¾¼ã¿ä¿®æ­£æ¤œè¨¼</h1>
    <p>å®Ÿè£…ã•ã‚ŒãŸCSSèª­ã¿è¾¼ã¿ä¿®æ­£ã®åŠ¹æœã‚’ç·åˆçš„ã«æ¤œè¨¼ã—ã¾ã™ã€‚</p>
    
    <div class="test-grid">
      <!-- ç‰©ä»¶é¸æŠãƒšãƒ¼ã‚¸ãƒ†ã‚¹ãƒˆ -->
      <div class="test-card">
        <h3>ğŸ“‹ ç‰©ä»¶é¸æŠãƒšãƒ¼ã‚¸</h3>
        <div id="property-status"></div>
        <button onclick="testPage('property_select.html', 'property')">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <a href="property_select.html" target="_blank" class="link-button">ãƒšãƒ¼ã‚¸ã‚’é–‹ã</a>
        <div id="property-results"></div>
      </div>
      
      <!-- éƒ¨å±‹é¸æŠãƒšãƒ¼ã‚¸ãƒ†ã‚¹ãƒˆ -->
      <div class="test-card">
        <h3>ğŸ  éƒ¨å±‹é¸æŠãƒšãƒ¼ã‚¸</h3>
        <div id="room-status"></div>
        <button onclick="testPage('room_select.html', 'room')">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <a href="room_select.html" target="_blank" class="link-button">ãƒšãƒ¼ã‚¸ã‚’é–‹ã</a>
        <div id="room-results"></div>
      </div>
      
      <!-- ãƒ¡ãƒ¼ã‚¿ãƒ¼èª­ã¿å–ã‚Šãƒšãƒ¼ã‚¸ãƒ†ã‚¹ãƒˆ -->
      <div class="test-card">
        <h3>ğŸ“Š ãƒ¡ãƒ¼ã‚¿ãƒ¼èª­ã¿å–ã‚Šãƒšãƒ¼ã‚¸</h3>
        <div id="meter-status"></div>
        <button onclick="testPage('meter_reading.html', 'meter')">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <a href="meter_reading.html" target="_blank" class="link-button">ãƒšãƒ¼ã‚¸ã‚’é–‹ã</a>
        <div id="meter-results"></div>
      </div>
    </div>
    
    <!-- ç·åˆçµæœ -->
    <div class="test-card">
      <h3>ğŸ“Š ç·åˆãƒ†ã‚¹ãƒˆçµæœ</h3>
      <div class="metrics" id="overall-metrics"></div>
      <button onclick="runAllTests()">ğŸš€ å…¨ãƒšãƒ¼ã‚¸ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
      <button onclick="generateReport()">ğŸ“„ ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ</button>
      <button onclick="clearAllResults()">ğŸ—‘ï¸ çµæœã‚¯ãƒªã‚¢</button>
      <div id="overall-results"></div>
    </div>
    
    <!-- ãƒ–ãƒ©ã‚¦ã‚¶æ¯”è¼ƒãƒ†ã‚¹ãƒˆ -->
    <div class="test-card">
      <h3>ğŸŒ ãƒ–ãƒ©ã‚¦ã‚¶æ¯”è¼ƒãƒ†ã‚¹ãƒˆ</h3>
      <p>ç•°ãªã‚‹ãƒ–ãƒ©ã‚¦ã‚¶ã§ã®CSSèª­ã¿è¾¼ã¿å‹•ä½œã‚’æ¯”è¼ƒã—ã¾ã™ã€‚</p>
      <div id="browser-info"></div>
      <button onclick="detectBrowserInfo()">ãƒ–ãƒ©ã‚¦ã‚¶æƒ…å ±å–å¾—</button>
    </div>
  </div>

  <script>
    let testResults = {
      property: null,
      room: null,
      meter: null
    };

    // å€‹åˆ¥ãƒšãƒ¼ã‚¸ãƒ†ã‚¹ãƒˆ
    function testPage(url, pageType) {
      const statusDiv = document.getElementById(`${pageType}-status`);
      const resultsDiv = document.getElementById(`${pageType}-results`);
      
      statusDiv.innerHTML = '<span class="status-indicator status-warning"></span>ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...';
      resultsDiv.innerHTML = '';
      
      const startTime = performance.now();
      
      // éš ã—iframeã§ãƒšãƒ¼ã‚¸ã‚’èª­ã¿è¾¼ã‚“ã§ãƒ†ã‚¹ãƒˆ
      const iframe = document.createElement('iframe');
      iframe.style.display = 'none';
      iframe.src = url;
      
      iframe.onload = () => {
        const loadTime = performance.now() - startTime;
        
        try {
          const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
          const iframeWindow = iframe.contentWindow;
          
          // CSSèª­ã¿è¾¼ã¿çŠ¶æ³ã‚’ãƒã‚§ãƒƒã‚¯
          const cssLinks = iframeDoc.querySelectorAll('link[rel="stylesheet"]');
          const cssLoaded = Array.from(cssLinks).every(link => link.sheet !== null);
          
          // ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«CSSã®åŠ¹æœã‚’ãƒã‚§ãƒƒã‚¯
          const testElement = iframeDoc.createElement('div');
          testElement.className = 'mantine-button';
          testElement.style.position = 'absolute';
          testElement.style.visibility = 'hidden';
          iframeDoc.body.appendChild(testElement);
          
          const computedStyle = iframeWindow.getComputedStyle(testElement);
          const hasButtonStyles = computedStyle.backgroundColor !== 'rgba(0, 0, 0, 0)' && 
                                 computedStyle.backgroundColor !== 'transparent';
          
          iframeDoc.body.removeChild(testElement);
          
          // Rootè¦ç´ ã®FOUCå¯¾ç­–ãƒã‚§ãƒƒã‚¯
          const rootElement = iframeDoc.getElementById('root');
          const hasStylesClass = rootElement && 
            (rootElement.classList.contains('styles-loading') || rootElement.classList.contains('styles-loaded'));
          
          // çµæœã‚’ã¾ã¨ã‚
          const result = {
            url,
            loadTime: loadTime.toFixed(2),
            cssLoaded,
            hasButtonStyles,
            hasStylesClass,
            cssCount: cssLinks.length,
            timestamp: new Date().toLocaleTimeString()
          };
          
          testResults[pageType] = result;
          displayTestResult(pageType, result);
          
        } catch (error) {
          const errorResult = {
            url,
            error: error.message,
            loadTime: loadTime.toFixed(2),
            timestamp: new Date().toLocaleTimeString()
          };
          
          testResults[pageType] = errorResult;
          displayErrorResult(pageType, errorResult);
        }
        
        document.body.removeChild(iframe);
      };
      
      iframe.onerror = () => {
        const errorResult = {
          url,
          error: 'ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼',
          timestamp: new Date().toLocaleTimeString()
        };
        
        testResults[pageType] = errorResult;
        displayErrorResult(pageType, errorResult);
        document.body.removeChild(iframe);
      };
      
      document.body.appendChild(iframe);
    }

    function displayTestResult(pageType, result) {
      const statusDiv = document.getElementById(`${pageType}-status`);
      const resultsDiv = document.getElementById(`${pageType}-results`);
      
      const overallStatus = result.cssLoaded && result.hasButtonStyles && result.hasStylesClass;
      const statusClass = overallStatus ? 'status-ok' : 'status-warning';
      const statusText = overallStatus ? 'âœ… æ­£å¸¸' : 'âš ï¸ è¦ç¢ºèª';
      
      statusDiv.innerHTML = `<span class="status-indicator ${statusClass}"></span>${statusText}`;
      
      resultsDiv.innerHTML = `
        <div class="test-result ${overallStatus ? 'success' : 'warning'}">
          <strong>èª­ã¿è¾¼ã¿æ™‚é–“:</strong> ${result.loadTime}ms<br>
          <strong>CSSèª­ã¿è¾¼ã¿:</strong> ${result.cssLoaded ? 'âœ…' : 'âŒ'} (${result.cssCount}ãƒ•ã‚¡ã‚¤ãƒ«)<br>
          <strong>ã‚¹ã‚¿ã‚¤ãƒ«é©ç”¨:</strong> ${result.hasButtonStyles ? 'âœ…' : 'âŒ'}<br>
          <strong>FOUCå¯¾ç­–:</strong> ${result.hasStylesClass ? 'âœ…' : 'âŒ'}<br>
          <strong>ãƒ†ã‚¹ãƒˆæ™‚åˆ»:</strong> ${result.timestamp}
        </div>
      `;
    }

    function displayErrorResult(pageType, result) {
      const statusDiv = document.getElementById(`${pageType}-status`);
      const resultsDiv = document.getElementById(`${pageType}-results`);
      
      statusDiv.innerHTML = '<span class="status-indicator status-error"></span>âŒ ã‚¨ãƒ©ãƒ¼';
      
      resultsDiv.innerHTML = `
        <div class="test-result error">
          <strong>ã‚¨ãƒ©ãƒ¼:</strong> ${result.error}<br>
          <strong>URL:</strong> ${result.url}<br>
          <strong>æ™‚åˆ»:</strong> ${result.timestamp}
        </div>
      `;
    }

    // å…¨ãƒšãƒ¼ã‚¸ãƒ†ã‚¹ãƒˆ
    function runAllTests() {
      testPage('property_select.html', 'property');
      setTimeout(() => testPage('room_select.html', 'room'), 1000);
      setTimeout(() => testPage('meter_reading.html', 'meter'), 2000);
      setTimeout(updateOverallMetrics, 3000);
    }

    // ç·åˆãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°
    function updateOverallMetrics() {
      const metricsDiv = document.getElementById('overall-metrics');
      
      const completedTests = Object.values(testResults).filter(r => r !== null).length;
      const successfulTests = Object.values(testResults).filter(r => 
        r && !r.error && r.cssLoaded && r.hasButtonStyles && r.hasStylesClass
      ).length;
      
      const averageLoadTime = Object.values(testResults)
        .filter(r => r && r.loadTime)
        .reduce((sum, r, _, arr) => sum + parseFloat(r.loadTime) / arr.length, 0);
      
      metricsDiv.innerHTML = `
        <div class="metric">
          <div class="metric-value">${completedTests}/3</div>
          <div class="metric-label">å®Œäº†ãƒ†ã‚¹ãƒˆ</div>
        </div>
        <div class="metric">
          <div class="metric-value">${successfulTests}/3</div>
          <div class="metric-label">æˆåŠŸãƒ†ã‚¹ãƒˆ</div>
        </div>
        <div class="metric">
          <div class="metric-value">${averageLoadTime.toFixed(1)}ms</div>
          <div class="metric-label">å¹³å‡èª­ã¿è¾¼ã¿æ™‚é–“</div>
        </div>
        <div class="metric">
          <div class="metric-value">${Math.round((successfulTests/completedTests)*100)}%</div>
          <div class="metric-label">æˆåŠŸç‡</div>
        </div>
      `;
    }

    // ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
    function generateReport() {
      const reportData = {
        timestamp: new Date().toLocaleString(),
        testResults,
        userAgent: navigator.userAgent,
        url: window.location.href
      };
      
      const reportText = `
# CSSèª­ã¿è¾¼ã¿ä¿®æ­£æ¤œè¨¼ãƒ¬ãƒãƒ¼ãƒˆ

## å®Ÿè¡Œæƒ…å ±
- å®Ÿè¡Œæ—¥æ™‚: ${reportData.timestamp}
- URL: ${reportData.url}
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ: ${reportData.userAgent}

## ãƒ†ã‚¹ãƒˆçµæœ

### ç‰©ä»¶é¸æŠãƒšãƒ¼ã‚¸
${formatResultForReport(testResults.property)}

### éƒ¨å±‹é¸æŠãƒšãƒ¼ã‚¸
${formatResultForReport(testResults.room)}

### ãƒ¡ãƒ¼ã‚¿ãƒ¼èª­ã¿å–ã‚Šãƒšãƒ¼ã‚¸
${formatResultForReport(testResults.meter)}

## ç·åˆè©•ä¾¡
${generateOverallAssessment()}
      `;
      
      // ãƒ¬ãƒãƒ¼ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
      const blob = new Blob([reportText], { type: 'text/plain; charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `css-validation-report-${new Date().toISOString().slice(0,19).replace(/:/g, '-')}.txt`;
      a.click();
      URL.revokeObjectURL(url);
    }

    function formatResultForReport(result) {
      if (!result) return '- ãƒ†ã‚¹ãƒˆæœªå®Ÿè¡Œ';
      if (result.error) return `- ã‚¨ãƒ©ãƒ¼: ${result.error}`;
      
      return `
- èª­ã¿è¾¼ã¿æ™‚é–“: ${result.loadTime}ms
- CSSèª­ã¿è¾¼ã¿: ${result.cssLoaded ? 'æˆåŠŸ' : 'å¤±æ•—'}
- ã‚¹ã‚¿ã‚¤ãƒ«é©ç”¨: ${result.hasButtonStyles ? 'æˆåŠŸ' : 'å¤±æ•—'}
- FOUCå¯¾ç­–: ${result.hasStylesClass ? 'é©ç”¨æ¸ˆã¿' : 'æœªé©ç”¨'}
      `;
    }

    function generateOverallAssessment() {
      const results = Object.values(testResults).filter(r => r !== null);
      const successCount = results.filter(r => 
        !r.error && r.cssLoaded && r.hasButtonStyles && r.hasStylesClass
      ).length;
      
      if (successCount === results.length && results.length === 3) {
        return 'âœ… å…¨ãƒšãƒ¼ã‚¸ã§CSSèª­ã¿è¾¼ã¿ä¿®æ­£ãŒæ­£å¸¸ã«æ©Ÿèƒ½ã—ã¦ã„ã¾ã™ã€‚';
      } else if (successCount > 0) {
        return `âš ï¸ ${successCount}/${results.length}ãƒšãƒ¼ã‚¸ã§ä¿®æ­£ãŒæ©Ÿèƒ½ã—ã¦ã„ã¾ã™ãŒã€ä¸€éƒ¨ã«å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚`;
      } else {
        return 'âŒ CSSèª­ã¿è¾¼ã¿ä¿®æ­£ã«å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚ç¢ºèªãŒå¿…è¦ã§ã™ã€‚';
      }
    }

    // ãƒ–ãƒ©ã‚¦ã‚¶æƒ…å ±å–å¾—
    function detectBrowserInfo() {
      const browserInfoDiv = document.getElementById('browser-info');
      
      const info = {
        userAgent: navigator.userAgent,
        platform: navigator.platform,
        language: navigator.language,
        cookieEnabled: navigator.cookieEnabled,
        onLine: navigator.onLine,
        screenResolution: `${screen.width}x${screen.height}`,
        colorDepth: screen.colorDepth,
        timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone
      };
      
      browserInfoDiv.innerHTML = `
        <div class="test-result">
          <strong>ãƒ–ãƒ©ã‚¦ã‚¶:</strong> ${getBrowserName(info.userAgent)}<br>
          <strong>ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ :</strong> ${info.platform}<br>
          <strong>è¨€èª:</strong> ${info.language}<br>
          <strong>ç”»é¢è§£åƒåº¦:</strong> ${info.screenResolution}<br>
          <strong>è‰²æ·±åº¦:</strong> ${info.colorDepth}bit<br>
          <strong>ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³:</strong> ${info.timeZone}<br>
          <strong>ã‚ªãƒ³ãƒ©ã‚¤ãƒ³:</strong> ${info.onLine ? 'ã¯ã„' : 'ã„ã„ãˆ'}
        </div>
      `;
    }

    function getBrowserName(userAgent) {
      if (userAgent.includes('Chrome')) return 'Chrome';
      if (userAgent.includes('Firefox')) return 'Firefox';
      if (userAgent.includes('Safari')) return 'Safari';
      if (userAgent.includes('Edge')) return 'Edge';
      return 'ä¸æ˜';
    }

    function clearAllResults() {
      testResults = { property: null, room: null, meter: null };
      ['property', 'room', 'meter'].forEach(type => {
        document.getElementById(`${type}-status`).innerHTML = '';
        document.getElementById(`${type}-results`).innerHTML = '';
      });
      document.getElementById('overall-metrics').innerHTML = '';
      document.getElementById('overall-results').innerHTML = '';
    }

    // åˆæœŸåŒ–
    detectBrowserInfo();
  </script>
</body>
</html>
