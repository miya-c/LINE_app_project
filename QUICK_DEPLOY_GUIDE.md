# 統合システム デプロイガイド

## 🚀 簡単デプロイ手順

### **ステップ1: Google Apps Scriptプロジェクト作成**

1. [Google Spreadsheet](https://sheets.google.com)を開く
2. **拡張機能** > **Apps Script**をクリック
3. 新しいプロジェクトが作成される

### **ステップ2: ファイルのアップロード**

以下のファイルをApps Scriptプロジェクトに追加：

#### **メインスクリプト**
- `gas_dialog_functions.gs` をコピーして貼り付け

#### **HTMLファイル**
- `property_select_gas.html`
- `room_select_gas.html` 
- `meter_reading_gas.html`

各HTMLファイルを追加する方法：
1. **+** > **HTML ファイル**をクリック
2. ファイル名を入力（拡張子なし）
3. 内容をコピーして貼り付け

### **ステップ3: 初期設定の実行**

1. Apps Scriptエディタで以下のコードを実行：

```javascript
function initialSetup() {
  // 統合トリガーの設定
  setupIntegratedTriggers();
  
  // システム診断
  diagnoseIntegratedSystem();
  
  // 統合メニューの強制作成
  forceCreateIntegratedMenu();
  
  Logger.log('✅ 初期設定完了！');
}
```

2. **実行**ボタンをクリック
3. 必要な権限を許可

### **ステップ4: スプレッドシートの確認**

1. スプレッドシートに戻る
2. ページを再読み込み（F5）
3. メニューバーに以下が表示されることを確認：
   - **水道検針**メニュー
   - **総合カスタム処理**メニュー

## 📋 必要なシート構成

### **必須シート**

以下のシートを作成してください：

#### **1. 物件マスタ（または property_master）**
| 物件ID | 物件名 | 検針完了日 |
|--------|--------|------------|
| 001    | マンションA | |
| 002    | マンションB | |

#### **2. 部屋マスタ（または room_master）**  
| 物件ID | 部屋ID | 部屋名 |
|--------|--------|--------|
| 001    | 101    | 101号室 |
| 001    | 102    | 102号室 |

#### **3. inspection_data**
このシートは自動作成されます（**4. 初期検針データ作成**を実行）

## 🔧 トラブルシューティング

### **メニューが表示されない場合**

Apps Scriptエディタで実行：
```javascript
forceCreateIntegratedMenu();
```

### **権限エラーが発生する場合**

1. **実行** > **許可を確認**をクリック
2. Googleアカウントでログイン
3. 必要な権限をすべて許可

### **シートが見つからないエラー**

1. 必要なシートを作成
2. シート名を確認（英語・日本語両対応）
3. **🔧 シート名正規化**メニューを実行

## ✅ 動作確認

### **水道検針アプリのテスト**

1. **水道検針** > **アプリを開く**
2. 物件選択画面が表示される
3. 物件・部屋を選択して検針画面へ進む

### **総合カスタム処理のテスト**

1. **総合カスタム処理** > **🔍 データ整合性チェック**
2. 診断結果が表示される

## 📞 サポート機能

### **システム診断**
```javascript
diagnoseIntegratedSystem();
```

### **統合メニュー再作成**
```javascript
forceCreateIntegratedMenu();
```

### **トリガー再設定**
```javascript
setupIntegratedTriggers();
```

## 🎯 運用開始

1. ✅ 全ての機能が正常動作
2. ✅ データ入力・更新が可能
3. ✅ メニューが正常表示
4. ✅ エラーが発生しない

**🎉 デプロイ完了！本番運用を開始できます。**

---

## 📋 緊急時の連絡先

問題が発生した場合：
1. Apps Scriptのログを確認
2. `diagnoseIntegratedSystem()`を実行
3. 必要に応じてメニューを再作成
