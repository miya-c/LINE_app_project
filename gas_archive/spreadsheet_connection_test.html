<!DOCTYPE html>
<html lang="ja">
<head>
  <title>ğŸ“Š ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæ¥ç¶šãƒ†ã‚¹ãƒˆ v20250614c</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #333;
      min-height: 100vh;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    .header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 3px solid #007bff;
    }
    .header h1 {
      color: #007bff;
      font-size: 2.5em;
      margin: 0;
    }
    .header p {
      color: #666;
      font-size: 1.1em;
      margin: 10px 0 0 0;
    }
    .test-section {
      margin: 20px 0;
      padding: 20px;
      border: 2px solid #e9ecef;
      border-radius: 10px;
      background: #f8f9fa;
    }
    .test-section h3 {
      color: #495057;
      margin: 0 0 15px 0;
      font-size: 1.3em;
    }
    .status {
      padding: 10px 15px;
      border-radius: 8px;
      margin: 10px 0;
      font-weight: bold;
    }
    .status.loading {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      color: #856404;
    }
    .status.success {
      background: #d1edff;
      border: 1px solid #74b9ff;
      color: #0984e3;
    }
    .status.error {
      background: #ffe0e0;
      border: 1px solid #ff7675;
      color: #d63031;
    }
    .data-display {
      background: #343a40;
      color: #fff;
      padding: 15px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
      overflow-x: auto;
      max-height: 300px;
      overflow-y: auto;
      margin: 10px 0;
    }
    .test-button {
      background: #007bff;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 1em;
      cursor: pointer;
      margin: 5px;
      transition: all 0.3s ease;
    }
    .test-button:hover {
      background: #0056b3;
      transform: translateY(-2px);
    }
    .test-button:disabled {
      background: #6c757d;
      cursor: not-allowed;
      transform: none;
    }
    .summary {
      background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
    }
    .summary h3 {
      color: #8b4513;
      margin: 0 0 10px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ“Š ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæ¥ç¶šãƒ†ã‚¹ãƒˆ</h1>
      <p>Google Sheetsé€£æºã¨ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿çŠ¶æ³ã‚’ç¢ºèª</p>
    </div>

    <!-- ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼ -->
    <div class="summary">
      <h3>ğŸ¯ ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼</h3>
      <div id="overall-status">ãƒ†ã‚¹ãƒˆæº–å‚™ä¸­...</div>
    </div>

    <!-- 1. GAS WebApp URL ãƒ†ã‚¹ãƒˆ -->
    <div class="test-section">
      <h3>ğŸ”— 1. GAS WebApp URL æ¥ç¶šãƒ†ã‚¹ãƒˆ</h3>
      <button class="test-button" onclick="testGasConnection()">æ¥ç¶šãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
      <div id="gas-status" class="status loading">ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...</div>
      <div id="gas-data" class="data-display" style="display: none;"></div>
    </div>

    <!-- 2. ç‰©ä»¶ãƒã‚¹ã‚¿èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ -->
    <div class="test-section">
      <h3>ğŸ¢ 2. ç‰©ä»¶ãƒã‚¹ã‚¿èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ</h3>
      <button class="test-button" onclick="testGetProperties()">ç‰©ä»¶ãƒ‡ãƒ¼ã‚¿å–å¾—</button>
      <div id="properties-status" class="status loading">ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...</div>
      <div id="properties-data" class="data-display" style="display: none;"></div>
    </div>

    <!-- 3. éƒ¨å±‹ãƒã‚¹ã‚¿èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ -->
    <div class="test-section">
      <h3>ğŸ  3. éƒ¨å±‹ãƒã‚¹ã‚¿èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ</h3>
      <button class="test-button" onclick="testGetRooms()">éƒ¨å±‹ãƒ‡ãƒ¼ã‚¿å–å¾—</button>
      <div id="rooms-status" class="status loading">ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...</div>
      <div id="rooms-data" class="data-display" style="display: none;"></div>
    </div>

    <!-- 4. æ¤œé‡ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ -->
    <div class="test-section">
      <h3>ğŸ“‹ 4. æ¤œé‡ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ</h3>
      <button class="test-button" onclick="testGetMeterReadings()">æ¤œé‡ãƒ‡ãƒ¼ã‚¿å–å¾—</button>
      <div id="meter-status" class="status loading">ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...</div>
      <div id="meter-data" class="data-display" style="display: none;"></div>
    </div>

    <!-- 5. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæ§‹é€ ç¢ºèª -->
    <div class="test-section">
      <h3>ğŸ“ 5. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæ§‹é€ ç¢ºèª</h3>
      <button class="test-button" onclick="testSheetStructure()">æ§‹é€ ç¢ºèª</button>
      <div id="structure-status" class="status loading">ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...</div>
      <div id="structure-data" class="data-display" style="display: none;"></div>
    </div>

    <!-- å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œãƒœã‚¿ãƒ³ -->
    <div style="text-align: center; margin: 30px 0;">
      <button class="test-button" style="background: #28a745; font-size: 1.1em; padding: 15px 30px;" onclick="runAllTests()">
        ğŸš€ å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
      </button>
    </div>
  </div>

  <script>
    // GAS WebApp URLï¼ˆproperty_select.htmlã‹ã‚‰å–å¾—ï¼‰
    const gasWebAppUrl = 'https://script.google.com/macros/s/AKfycbzc90nBqci0SDVA7BaV55E1li-SVjYTFO6asIFoK6ZaCXx0KOA0ekL4S3YsxslpwKuo3A/exec';
    
    // ãƒ†ã‚¹ãƒˆçµæœã‚’ä¿å­˜
    const testResults = {
      gasConnection: null,
      properties: null,
      rooms: null,
      meterReadings: null,
      structure: null
    };

    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ãƒ˜ãƒ«ãƒ‘ãƒ¼
    function updateStatus(elementId, type, message) {
      const element = document.getElementById(elementId);
      element.className = `status ${type}`;
      element.textContent = message;
    }

    // ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºãƒ˜ãƒ«ãƒ‘ãƒ¼
    function displayData(elementId, data) {
      const element = document.getElementById(elementId);
      element.style.display = 'block';
      element.textContent = JSON.stringify(data, null, 2);
    }

    // 1. GASæ¥ç¶šãƒ†ã‚¹ãƒˆ
    async function testGasConnection() {
      updateStatus('gas-status', 'loading', 'ğŸ”„ GAS WebAppæ¥ç¶šãƒ†ã‚¹ãƒˆä¸­...');
      
      try {
        const response = await fetch(`${gasWebAppUrl}?action=getVersion&_t=${Date.now()}`);
        const data = await response.json();
        
        if (response.ok) {
          testResults.gasConnection = true;
          updateStatus('gas-status', 'success', 'âœ… GAS WebAppæ¥ç¶šæˆåŠŸ');
          displayData('gas-data', data);
        } else {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
      } catch (error) {
        testResults.gasConnection = false;
        updateStatus('gas-status', 'error', `âŒ GASæ¥ç¶šå¤±æ•—: ${error.message}`);
        displayData('gas-data', { error: error.message, url: gasWebAppUrl });
      }
      
      updateOverallStatus();
    }

    // 2. ç‰©ä»¶ãƒã‚¹ã‚¿èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
    async function testGetProperties() {
      updateStatus('properties-status', 'loading', 'ğŸ”„ ç‰©ä»¶ãƒã‚¹ã‚¿èª­ã¿è¾¼ã¿ä¸­...');
      
      try {
        const response = await fetch(`${gasWebAppUrl}?action=getProperties&_t=${Date.now()}`);
        const data = await response.json();
        
        if (response.ok && !data.error) {
          const count = Array.isArray(data) ? data.length : (data.data ? data.data.length : 0);
          testResults.properties = count;
          updateStatus('properties-status', 'success', `âœ… ç‰©ä»¶ãƒã‚¹ã‚¿èª­ã¿è¾¼ã¿æˆåŠŸ (${count}ä»¶)`);
          displayData('properties-data', data);
        } else {
          throw new Error(data.error || 'ç‰©ä»¶ãƒ‡ãƒ¼ã‚¿å–å¾—å¤±æ•—');
        }
      } catch (error) {
        testResults.properties = false;
        updateStatus('properties-status', 'error', `âŒ ç‰©ä»¶ãƒã‚¹ã‚¿èª­ã¿è¾¼ã¿å¤±æ•—: ${error.message}`);
        displayData('properties-data', { error: error.message });
      }
      
      updateOverallStatus();
    }

    // 3. éƒ¨å±‹ãƒã‚¹ã‚¿èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
    async function testGetRooms() {
      updateStatus('rooms-status', 'loading', 'ğŸ”„ éƒ¨å±‹ãƒã‚¹ã‚¿èª­ã¿è¾¼ã¿ä¸­...');
      
      try {
        // ãƒ†ã‚¹ãƒˆç”¨ç‰©ä»¶IDï¼ˆãƒ‘ãƒ«ãƒã‚¤ãƒ„å¹³ç”°ï¼‰
        const testPropertyId = 'P000001';
        const response = await fetch(`${gasWebAppUrl}?action=getRooms&propertyId=${testPropertyId}&_t=${Date.now()}`);
        const data = await response.json();
        
        if (response.ok && !data.error) {
          const count = Array.isArray(data) ? data.length : (data.data ? data.data.length : 0);
          testResults.rooms = count;
          updateStatus('rooms-status', 'success', `âœ… éƒ¨å±‹ãƒã‚¹ã‚¿èª­ã¿è¾¼ã¿æˆåŠŸ (${count}ä»¶) - ç‰©ä»¶: ${testPropertyId}`);
          displayData('rooms-data', data);
        } else {
          throw new Error(data.error || 'éƒ¨å±‹ãƒ‡ãƒ¼ã‚¿å–å¾—å¤±æ•—');
        }
      } catch (error) {
        testResults.rooms = false;
        updateStatus('rooms-status', 'error', `âŒ éƒ¨å±‹ãƒã‚¹ã‚¿èª­ã¿è¾¼ã¿å¤±æ•—: ${error.message}`);
        displayData('rooms-data', { error: error.message });
      }
      
      updateOverallStatus();
    }

    // 4. æ¤œé‡ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆï¼ˆå¼·åŒ–ç‰ˆï¼‰
    async function testGetMeterReadings() {
      updateStatus('meter-status', 'loading', 'ğŸ”„ æ¤œé‡ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­...');
      
      try {
        // ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ‘ãƒ«ãƒã‚¤ãƒ„å¹³ç”° 101å·å®¤ï¼‰
        const testPropertyId = 'P000001';
        const testRoomId = 'R000001';
        const fetchUrl = `${gasWebAppUrl}?action=getMeterReadings&propertyId=${testPropertyId}&roomId=${testRoomId}&_t=${Date.now()}`;
        
        console.log('[Test] Meter readings fetch URL:', fetchUrl);
        
        const response = await fetch(fetchUrl);
        const data = await response.json();
        
        console.log('[Test] Meter readings response:', data);
        console.log('[Test] Response type:', typeof data);
        console.log('[Test] Response isArray:', Array.isArray(data));
        
        if (response.ok && !data.error) {
          let readings;
          let actualDataPayload;
          
          // çµ±ä¸€ãƒ¬ã‚¹ãƒãƒ³ã‚¹åˆ¤å®šå‡¦ç†ï¼ˆmeter_reading.htmlã¨åŒã˜ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
          if (data && data.success === true && Array.isArray(data.data)) {
            actualDataPayload = { 
              readings: data.data,
              debugInfo: data.debugInfo || {}
            };
            console.log('[Test] âœ… çµ±ä¸€å½¢å¼æ¡ç”¨ - ãƒ‡ãƒ¼ã‚¿ä»¶æ•°:', data.data.length);
          }
          else if (data && Array.isArray(data.readings)) {
            actualDataPayload = data;
            console.log('[Test] âš ï¸ readingså½¢å¼æ¡ç”¨');
          }
          else if (Array.isArray(data)) {
            actualDataPayload = { 
              readings: data, 
              debugInfo: { directArray: true }
            };
            console.log('[Test] âš ï¸ ç›´æ¥é…åˆ—å½¢å¼æ¡ç”¨');
          }
          else {
            console.error('[Test] âŒ ã™ã¹ã¦ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã«è©²å½“ã—ãªã„:', data);
            throw new Error('æ¤œé‡ãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ãŒèªè­˜ã§ãã¾ã›ã‚“');
          }
          
          readings = actualDataPayload.readings;
          const count = Array.isArray(readings) ? readings.length : 0;
          
          testResults.meterReadings = count;
          updateStatus('meter-status', 'success', `âœ… æ¤œé‡ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿æˆåŠŸ (${count}ä»¶) - éƒ¨å±‹: ${testPropertyId}/${testRoomId}`);
          
          // ã‚ˆã‚Šè©³ç´°ãªè¡¨ç¤ºæƒ…å ±
          const detailedData = {
            originalResponse: data,
            processedData: actualDataPayload,
            readingsCount: count,
            readingsContent: readings,
            debugInfo: actualDataPayload.debugInfo,
            testParams: { testPropertyId, testRoomId, fetchUrl }
          };
          
          displayData('meter-data', detailedData);
        } else {
          throw new Error(data.error || 'æ¤œé‡ãƒ‡ãƒ¼ã‚¿å–å¾—å¤±æ•—');
        }
      } catch (error) {
        testResults.meterReadings = false;
        updateStatus('meter-status', 'error', `âŒ æ¤œé‡ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å¤±æ•—: ${error.message}`);
        displayData('meter-data', { error: error.message });
      }
      
      updateOverallStatus();
    }

    // 5. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæ§‹é€ ç¢ºèªï¼ˆä»£ç†çš„ã«ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰æ¨æ¸¬ï¼‰
    async function testSheetStructure() {
      updateStatus('structure-status', 'loading', 'ğŸ”„ ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæ§‹é€ ç¢ºèªä¸­...');
      
      try {
        // è¤‡æ•°ã®APIã‚’å®Ÿè¡Œã—ã¦ã‚·ãƒ¼ãƒˆå­˜åœ¨ã‚’ç¢ºèª
        const tests = [
          { name: 'ç‰©ä»¶ãƒã‚¹ã‚¿', action: 'getProperties' },
          { name: 'éƒ¨å±‹ãƒã‚¹ã‚¿', action: 'getRooms', params: '&propertyId=P000001' },
          { name: 'æ¤œé‡ãƒ‡ãƒ¼ã‚¿', action: 'getMeterReadings', params: '&propertyId=P000001&roomId=R000001' }
        ];
        
        const results = {};
        
        for (const test of tests) {
          try {
            const url = `${gasWebAppUrl}?action=${test.action}${test.params || ''}&_t=${Date.now()}`;
            const response = await fetch(url);
            const data = await response.json();
            
            results[test.name] = {
              status: response.ok && !data.error ? 'âœ… æ­£å¸¸' : 'âŒ ã‚¨ãƒ©ãƒ¼',
              error: data.error || null,
              available: response.ok && !data.error
            };
          } catch (error) {
            results[test.name] = {
              status: 'âŒ ã‚¨ãƒ©ãƒ¼',
              error: error.message,
              available: false
            };
          }
        }
        
        const availableSheets = Object.values(results).filter(r => r.available).length;
        testResults.structure = availableSheets;
        
        updateStatus('structure-status', 'success', `âœ… ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæ§‹é€ ç¢ºèªå®Œäº† (${availableSheets}/3 ã‚·ãƒ¼ãƒˆåˆ©ç”¨å¯èƒ½)`);
        displayData('structure-data', results);
        
      } catch (error) {
        testResults.structure = false;
        updateStatus('structure-status', 'error', `âŒ æ§‹é€ ç¢ºèªå¤±æ•—: ${error.message}`);
        displayData('structure-data', { error: error.message });
      }
      
      updateOverallStatus();
    }

    // å…¨ä½“ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
    function updateOverallStatus() {
      const overallElement = document.getElementById('overall-status');
      const completedTests = Object.values(testResults).filter(r => r !== null).length;
      const successfulTests = Object.values(testResults).filter(r => r !== null && r !== false).length;
      
      if (completedTests === 0) {
        overallElement.textContent = 'ãƒ†ã‚¹ãƒˆæº–å‚™ä¸­...';
        return;
      }
      
      const percentage = Math.round((successfulTests / 5) * 100);
      const status = percentage >= 80 ? 'ğŸŸ¢ è‰¯å¥½' : percentage >= 60 ? 'ğŸŸ¡ æ³¨æ„' : 'ğŸ”´ å•é¡Œã‚ã‚Š';
      
      overallElement.innerHTML = `
        <strong>${status}</strong> - 
        æˆåŠŸ: ${successfulTests}/5 ãƒ†ã‚¹ãƒˆ (${percentage}%)<br>
        <small>å®Œäº†: ${completedTests}/5 ãƒ†ã‚¹ãƒˆ</small>
      `;
    }

    // å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
    async function runAllTests() {
      console.log('ğŸš€ å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œé–‹å§‹');
      
      // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
      const buttons = document.querySelectorAll('.test-button');
      buttons.forEach(btn => btn.disabled = true);
      
      try {
        await testGasConnection();
        await new Promise(resolve => setTimeout(resolve, 500)); // 500mså¾…æ©Ÿ
        
        await testGetProperties();
        await new Promise(resolve => setTimeout(resolve, 500));
        
        await testGetRooms();
        await new Promise(resolve => setTimeout(resolve, 500));
        
        await testGetMeterReadings();
        await new Promise(resolve => setTimeout(resolve, 500));
        
        await testSheetStructure();
        
        console.log('ğŸ‰ å…¨ãƒ†ã‚¹ãƒˆå®Œäº†');
        
        // å…¨ãƒ†ã‚¹ãƒˆå®Œäº†å¾Œã«meter readingç”»é¢ã¸ã®ç›´æ¥ãƒªãƒ³ã‚¯ãƒ†ã‚¹ãƒˆã‚’ææ¡ˆ
        showMeterReadingTestOption();
        
      } finally {
        // ãƒœã‚¿ãƒ³ã‚’å†æœ‰åŠ¹åŒ–
        buttons.forEach(btn => btn.disabled = false);
      }
    }

    // Meter Readingç”»é¢ãƒ†ã‚¹ãƒˆã‚ªãƒ—ã‚·ãƒ§ãƒ³è¡¨ç¤º
    function showMeterReadingTestOption() {
      const container = document.querySelector('.container');
      
      const testSection = document.createElement('div');
      testSection.className = 'test-section';
      testSection.style.backgroundColor = '#e8f5e8';
      testSection.style.borderColor = '#4caf50';
      
      testSection.innerHTML = `
        <h3>ğŸ§ª Meter Readingç”»é¢ ç›´æ¥ãƒ†ã‚¹ãƒˆ</h3>
        <p>ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæ¥ç¶šãŒæ­£å¸¸ãªå ´åˆã€å®Ÿéš›ã®meter readingç”»é¢ã‚’ãƒ†ã‚¹ãƒˆã§ãã¾ã™ã€‚</p>
        <div style="margin: 15px 0;">
          <button class="test-button" onclick="testMeterReadingPage()" style="background: #4caf50;">
            ğŸ”— Meter Readingç”»é¢ã‚’é–‹ã (ãƒ†ã‚¹ãƒˆç”¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿)
          </button>
          <button class="test-button" onclick="openPropertySelect()" style="background: #2196f3;">
            ğŸ  Property Selectç”»é¢ã‚’é–‹ã
          </button>
        </div>
        <div id="meter-test-status" class="status" style="display: none;"></div>
      `;
      
      container.appendChild(testSection);
    }

    // Meter Readingç”»é¢ã‚’ç›´æ¥ãƒ†ã‚¹ãƒˆ
    function testMeterReadingPage() {
      // ãƒ†ã‚¹ãƒˆç”¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§meter readingç”»é¢ã‚’é–‹ã
      const testUrl = `meter_reading.html?propertyId=P000001&propertyName=ãƒ‘ãƒ«ãƒã‚¤ãƒ„å¹³ç”°&roomId=R000001&roomName=101å·å®¤&debug=true`;
      
      const statusDiv = document.getElementById('meter-test-status');
      statusDiv.className = 'status loading';
      statusDiv.style.display = 'block';
      statusDiv.textContent = 'ğŸ”„ Meter Readingç”»é¢ã‚’é–‹ã„ã¦ã„ã¾ã™...';
      
      // sessionStorageã«gasWebAppUrlã‚’è¨­å®š
      sessionStorage.setItem('gasWebAppUrl', gasWebAppUrl);
      
      setTimeout(() => {
        statusDiv.className = 'status success';
        statusDiv.innerHTML = `âœ… æ–°ã—ã„ã‚¿ãƒ–ã§Meter Readingç”»é¢ãŒé–‹ãã¾ã—ãŸ<br><small>ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ç¢ºèªã—ã¦ãã ã•ã„</small>`;
      }, 1000);
      
      window.open(testUrl, '_blank');
    }

    // Property Selectç”»é¢ã‚’é–‹ã
    function openPropertySelect() {
      sessionStorage.setItem('gasWebAppUrl', gasWebAppUrl);
      window.open('property_select.html', '_blank');
    }

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸè¡¨ç¤º
    window.addEventListener('load', () => {
      console.log('ğŸ“Š ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæ¥ç¶šãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†');
      console.log('GAS WebApp URL:', gasWebAppUrl);
      updateOverallStatus();
    });
  </script>
</body>
</html>
