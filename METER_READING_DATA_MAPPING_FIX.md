# ğŸ¯ Meter Reading ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºå•é¡Œ - å®Œå…¨è§£æ±ºå ±å‘Šæ›¸

## ğŸ“… æœ€çµ‚æ›´æ–°æ—¥æ™‚
2025å¹´6æœˆ14æ—¥ v20250614d - ãƒ‡ãƒ¼ã‚¿ãƒãƒƒãƒ”ãƒ³ã‚°å®Œå…¨ä¿®æ­£ç‰ˆ

## ğŸ” å•é¡Œã®ç‰¹å®šã¨è§£æ±º

### åŸå› åˆ†æ
ãƒ­ã‚°è§£æã«ã‚ˆã‚Šä»¥ä¸‹ãŒåˆ¤æ˜ï¼š
- âœ… **ãƒ‡ãƒ¼ã‚¿å–å¾—ã¯æ­£å¸¸** - GAS WebAppã‹ã‚‰1ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ­£å¸¸å–å¾—
- âœ… **React Stateè¨­å®šã‚‚æ­£å¸¸** - meterReadingsé…åˆ—ã«æ­£ã—ãè¨­å®š
- âœ… **ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å‡¦ç†ã‚‚å®Ÿè¡Œ** - mapãƒ«ãƒ¼ãƒ—ã‚‚æ­£å¸¸ã«å®Ÿè¡Œã•ã‚Œã‚‹
- âŒ **ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®ä¸ä¸€è‡´** - GASã‹ã‚‰è¿”ã•ã‚Œã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®æœŸå¾…å€¤ãŒä¸ä¸€è‡´

### æ ¹æœ¬åŸå› 
**GAS ã® `getMeterReadings` é–¢æ•°ãŒè¿”ã™ãƒ‡ãƒ¼ã‚¿æ§‹é€ **ï¼š
```javascript
// GASã‹ã‚‰è¿”ã•ã‚Œã‚‹å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ï¼ˆinspection_dataã‚·ãƒ¼ãƒˆã®åˆ—åãã®ã¾ã¾ï¼‰
[
  {
    "è¨˜éŒ²ID": "780afee1-4aaf-445b-84c5-008926c813f6",
    "ç‰©ä»¶ID": "P000001",
    "éƒ¨å±‹ID": "R000001", 
    "æ¤œé‡æ—¥": "2024-12-15",
    "ä»Šå›æŒ‡ç¤ºæ•°": "150",
    "å‰å›æŒ‡ç¤ºæ•°": "120",
    "çŠ¶æ…‹": "æ­£å¸¸"
  }
]
```

**ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãŒæœŸå¾…ã—ã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿æ§‹é€ **ï¼š
```javascript
// meter_reading.htmlãŒæœŸå¾…ã™ã‚‹æ§‹é€ 
[
  {
    "date": "2024-12-15",
    "currentReading": "150", 
    "previousReading": "120",
    "status": "æ­£å¸¸"
  }
]
```

## ğŸ› ï¸ å®Ÿæ–½ã—ãŸä¿®æ­£

### 1. **ãƒ‡ãƒ¼ã‚¿ãƒãƒƒãƒ”ãƒ³ã‚°å‡¦ç†ã®è¿½åŠ **
```javascript
const mappedReadings = readings.map((rawReading, index) => {
  return {
    // æ—¥æœ¬èªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å â†’ è‹±èªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å ãƒãƒƒãƒ”ãƒ³ã‚°
    date: rawReading['æ¤œé‡æ—¥'] || rawReading['date'] || '',
    currentReading: rawReading['ä»Šå›æŒ‡ç¤ºæ•°'] || rawReading['currentReading'] || '',
    previousReading: rawReading['å‰å›æŒ‡ç¤ºæ•°'] || rawReading['previousReading'] || '',
    previousPreviousReading: rawReading['å‰ã€…å›æŒ‡ç¤ºæ•°'] || rawReading['previousPreviousReading'] || '',
    threeTimesPrevious: rawReading['å‰ã€…ã€…å›æŒ‡ç¤ºæ•°'] || rawReading['threeTimesPrevious'] || '',
    status: rawReading['çŠ¶æ…‹'] || rawReading['status'] || 'æ­£å¸¸',
    // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
    recordId: rawReading['è¨˜éŒ²ID'] || rawReading['recordId'] || '',
    propertyId: rawReading['ç‰©ä»¶ID'] || rawReading['propertyId'] || '',
    roomId: rawReading['éƒ¨å±‹ID'] || rawReading['roomId'] || '',
    _original: rawReading // ãƒ‡ãƒãƒƒã‚°ç”¨
  };
});
```

### 2. **è©³ç´°ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½ã®å¼·åŒ–**
- âœ… ç”Ÿãƒ‡ãƒ¼ã‚¿ã¨ãƒãƒƒãƒ”ãƒ³ã‚°å¾Œãƒ‡ãƒ¼ã‚¿ã®ä¸¡æ–¹ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›
- âœ… ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®è©³ç´°è§£ææ©Ÿèƒ½
- âœ… ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã®ä¸€è¦§è¡¨ç¤º
- âœ… UIæ¡ä»¶åˆ†å²ã®è©³ç´°ãƒ­ã‚°

### 3. **ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã®å®Ÿè£…**
è¤‡æ•°ã®å¯èƒ½æ€§ã®ã‚ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã«å¯¾å¿œï¼š
- `æ¤œé‡æ—¥` / `date` / `è¨˜éŒ²æ—¥`
- `ä»Šå›æŒ‡ç¤ºæ•°` / `currentReading` / `æŒ‡ç¤ºæ•°`
- `å‰å›æŒ‡ç¤ºæ•°` / `previousReading` / `å‰å›`
- `çŠ¶æ…‹` / `status`

## âœ… æœŸå¾…ã•ã‚Œã‚‹çµæœ

### ä¿®æ­£å¾Œã®å‹•ä½œ
1. **ãƒ‡ãƒ¼ã‚¿å–å¾—** - GASã‹ã‚‰æ—¥æœ¬èªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
2. **ãƒ‡ãƒ¼ã‚¿ãƒãƒƒãƒ”ãƒ³ã‚°** - è‹±èªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã«è‡ªå‹•å¤‰æ›
3. **UIè¡¨ç¤º** - å¤‰æ›ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã§æ­£å¸¸ã«ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤º
4. **å…¥åŠ›ãƒ»æ›´æ–°** - æ—¢å­˜ã®ãƒ­ã‚¸ãƒƒã‚¯ã§æ­£å¸¸å‹•ä½œ

### è¡¨ç¤ºã•ã‚Œã‚‹ã¹ãå†…å®¹
```
æ¤œé‡å±¥æ­´
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¤œé‡æ—¥æ™‚        â”‚ ä»Šå›æŒ‡ç¤ºæ•°(ã¥)   â”‚ ä»Šå›ä½¿ç”¨é‡      â”‚ çŠ¶æ…‹     â”‚ å‰å›å±¥æ­´        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æœ€çµ‚æ¤œé‡æ—¥: 12æœˆ15æ—¥ â”‚ [150]        â”‚ 30ã¥         â”‚ æ­£å¸¸     â”‚ å‰å›: 120      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æ¤œè¨¼æ–¹æ³•

### 1. ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã®ç¢ºèª
```
[meter_reading] ç”Ÿãƒ‡ãƒ¼ã‚¿ [0]: {è¨˜éŒ²ID: "780afee1...", ç‰©ä»¶ID: "P000001", ...}
[meter_reading] ãƒãƒƒãƒ”ãƒ³ã‚°å¾Œ [0]: {date: "2024-12-15", currentReading: "150", ...}
[meter_reading] æ¡ä»¶åˆ†å²ãƒã‚§ãƒƒã‚¯: æ¡ä»¶çµæœ: true
```

### 2. UIè¡¨ç¤ºã§ã®ç¢ºèª
- ãƒ‡ãƒãƒƒã‚°æƒ…å ±æ¬„ã«ãƒãƒƒãƒ”ãƒ³ã‚°å¾Œã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ è¡¨ç¤º
- ãƒ†ãƒ¼ãƒ–ãƒ«ã«æ¤œé‡ãƒ‡ãƒ¼ã‚¿ãŒæ­£å¸¸è¡¨ç¤º
- å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒæ©Ÿèƒ½

### 3. ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ã§ã®ç¢ºèª
- `meter_reading_debug.html` - ãƒ‡ãƒ¼ã‚¿æ§‹é€ è§£æ
- `spreadsheet_connection_test.html` - ç·åˆæ¥ç¶šãƒ†ã‚¹ãƒˆ

## ğŸ“ ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«

### ä¸»è¦ä¿®æ­£
- `/meter_reading.html` - ãƒ‡ãƒ¼ã‚¿ãƒãƒƒãƒ”ãƒ³ã‚°å‡¦ç†è¿½åŠ  (v20250614d)

### æ”¯æ´ãƒ„ãƒ¼ãƒ«
- `/meter_reading_debug.html` - å°‚ç”¨ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«
- `/spreadsheet_connection_test.html` - ç·åˆãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«

## ğŸš€ ä»Šå¾Œã®æ”¹å–„ææ¡ˆ

### 1. GASå´ã®æ¨™æº–åŒ–
```javascript
// GAS getMeterReadings é–¢æ•°ã®å‡ºåŠ›ã‚’è‹±èªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã«çµ±ä¸€
function getMeterReadings(propertyId, roomId) {
  // ... æ—¢å­˜ã®å‡¦ç† ...
  
  // ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åãƒãƒƒãƒ”ãƒ³ã‚°ã‚’GASå´ã§å®Ÿè¡Œ
  const mappedReadings = rawReadings.map(reading => ({
    date: reading['æ¤œé‡æ—¥'],
    currentReading: reading['ä»Šå›æŒ‡ç¤ºæ•°'],
    previousReading: reading['å‰å›æŒ‡ç¤ºæ•°'],
    // ... ãã®ä»–ã®ãƒãƒƒãƒ”ãƒ³ã‚°
  }));
  
  return mappedReadings;
}
```

### 2. çµ±ä¸€ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ã®å®Œå…¨æ¡ç”¨
```javascript
// å…¨ã¦ã®GAS API ã§çµ±ä¸€å½¢å¼ã‚’ä½¿ç”¨
return {
  success: true,
  data: mappedReadings,
  debugInfo: { 
    originalCount: rawReadings.length,
    mappedCount: mappedReadings.length 
  }
};
```

### 3. TypeScriptå‹å®šç¾©ã®è¿½åŠ 
```typescript
interface MeterReading {
  date: string;
  currentReading: string;
  previousReading?: string;
  status: string;
  recordId?: string;
}
```

## ğŸ“‹ ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### âœ… å®Œäº†æ¸ˆã¿
- [x] å•é¡Œã®æ ¹æœ¬åŸå› ç‰¹å®š
- [x] ãƒ‡ãƒ¼ã‚¿ãƒãƒƒãƒ”ãƒ³ã‚°å‡¦ç†å®Ÿè£…
- [x] è©³ç´°ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½è¿½åŠ 
- [x] ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†å®Ÿè£…
- [x] ãƒ†ã‚¹ãƒˆæ”¯æ´ãƒ„ãƒ¼ãƒ«æä¾›

### ğŸ”„ æ¤œè¨¼å¾…ã¡
- [ ] å®Ÿéš›ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ã®è¡¨ç¤ºç¢ºèª
- [ ] ãƒ‡ãƒ¼ã‚¿å…¥åŠ›ãƒ»æ›´æ–°æ©Ÿèƒ½ã®å‹•ä½œç¢ºèª
- [ ] è¤‡æ•°ä»¶ãƒ‡ãƒ¼ã‚¿ã§ã®è¡¨ç¤ºç¢ºèª
- [ ] å„ç¨®ãƒ–ãƒ©ã‚¦ã‚¶ã§ã®äº’æ›æ€§ç¢ºèª

---
**Status**: ğŸ¯ ãƒ‡ãƒ¼ã‚¿ãƒãƒƒãƒ”ãƒ³ã‚°ä¿®æ­£å®Œäº† | æœ€çµ‚æ¤œè¨¼å¾…ã¡
