# 🚰 水道検針システム 機能ガイド

このドキュメントは、スプレッドシートの「水道検針システム」メニューから利用できる各機能について説明します。

## １．基本機能

### 📱 水道検針アプリを開く

サイドバーに水道検針用のWebアプリケーションを表示します。このアプリを使って、物件や部屋を選択し、検針データを入力・更新できます。

### 📋 物件一覧を表示

「物件マスタ」シートに登録されている全ての物件を一覧で表示します。

### 🏠 部屋一覧を表示

指定した物件IDに紐づく部屋を一覧で表示します。部屋ごとの検針状況（完了／未完了）も確認できます。

**検針不要フラグについて：**

- 「inspection_data」シートの「検針不要」列に値が入っている部屋は、検針不要として扱われます
- 検針不要の部屋は画面上でグレーアウト表示され、クリックできません
- 検針不要フラグは部屋単位で設定されます

---

## ２．📊 データ管理

このメニューの機能は、データの整合性を保ち、システムを正常に運用するために使用します。

### 1. 物件IDフォーマット整理

「物件マスタ」シートの「物件ID」を、システムで定められた形式（例: `P`+数字6桁）に統一します。

### 2. 部屋マスタの物件IDフォーマット整理

「部屋マスタ」シートの「物件ID」を、物件マスタのID形式と一致するように統一します。

### 3. 部屋ID連番自動生成

「部屋マスタ」シートの「部屋ID」を物件別に連番で自動生成します。各物件内でR001, R002, R003...の形式で部屋IDを割り当てます。部屋名がある場合は部屋名順でソートしてから連番を付与します。

### 4. 孤立データ削除

「物件マスタ」に存在しない物件IDが「部屋マスタ」に残っている場合、その不要な部屋データを削除します。

### 5. 初期検針データ作成

「部屋マスタ」に登録されている全ての部屋に対して、「検針データ」シートに初期レコードを作成します。初回設定時や、データが空の場合に使用します。

### 6. 新規部屋反映

「部屋マスタ」に追加された新しい部屋を、「検針データ」シートに自動で追加します。

### 7. 月次処理実行

月末の締め処理を行います。現在の検針データを過去の履歴として別シートに保存し、「検針データ」シートを翌月のためにリセットします。

---

## ３．🔍 データ品質管理

データの品質を維持し、検索機能を最適化するためのツールです。

### 1. 重複データ削除

各マスタシートやデータシートから、重複している行を自動で削除します。

### 2. データ整合性チェック

「物件マスタ」「部屋マスタ」「検針データ」間のデータの矛盾や不整合がないかチェックし、結果を報告します。

### 3. 検索インデックス作成

物件名や部屋名を高速に検索するための「インデックス（索引）」を作成します。データを更新した後に実行すると、検索パフォーマンスが向上します。

### 4. 検索機能テスト

作成されたインデックスが正しく機能しているか、いくつかのテストケースを実行して確認します。

### 5. 検索ガイド表示

高速検索機能の詳しい使い方や、利用可能な検索方法についてのガイドを表示します。

---

## ４．🧪 テスト・デバッグ

開発者向けのテスト用機能です。

### 1. ライブラリ接続テスト

このスプレッドシートが、水道検針システムのコア機能（cmlibrary）に正しく接続されているかを確認します。

### 2. 利用可能関数一覧

開発者が直接呼び出すことができる、ライブラリ内の関数リストをコンソールに表示します。

### 3. 使用例実行

ライブラリの基本的な使い方を示すサンプルコードを実行し、コンソールに結果を表示します。

