# room_select.html ãƒ‡ãƒ¼ã‚¿é€£æºä¿®æ­£ - æœ€çµ‚å®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ

## ä¿®æ­£æ¦‚è¦
room_select.htmlãŒæœŸå¾…ã™ã‚‹ãƒ‡ãƒ¼ã‚¿å½¢å¼ã«å®Œå…¨å¯¾å¿œã™ã‚‹ã‚ˆã†ã€GASã®getRoomsé–¢æ•°ã‚’æœ€çµ‚èª¿æ•´ã—ã¾ã—ãŸã€‚

## ä¿®æ­£ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«

### 1. api_data_functions.gs
- **getRoomsé–¢æ•°**: HTMLãŒæœŸå¾…ã™ã‚‹æ­£ç¢ºãªãƒ‡ãƒ¼ã‚¿å½¢å¼ã«èª¿æ•´
- **æ¤œé‡å®Œäº†åˆ¤å®š**: å®Ÿéš›ã®CSVãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆæ¤œé‡æ—¥æ™‚ï¼‰ã«åŸºã¥ãå‡¦ç†
- **æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ä¿®æ­£**: tryãƒ–ãƒ­ãƒƒã‚¯ã®ä¸æ­£ãªè¨˜è¿°ã‚’ä¿®æ­£

### 2. HTMLãŒæœŸå¾…ã™ã‚‹ãƒ‡ãƒ¼ã‚¿å½¢å¼ã¨ã®å¯¾å¿œ

#### å¿…è¦ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
| HTMLãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | GASè¿”å´å€¤ | èª¬æ˜ |
|---|---|---|
| `data.property.name` | âœ… ç‰©ä»¶å | ç‰©ä»¶ãƒã‚¹ã‚¿ã‹ã‚‰å–å¾— |
| `room.id` | âœ… éƒ¨å±‹ID | éƒ¨å±‹ãƒã‚¹ã‚¿ã®éƒ¨å±‹IDåˆ— |
| `room.name` or `room['éƒ¨å±‹å']` | âœ… éƒ¨å±‹å | éƒ¨å±‹ãƒã‚¹ã‚¿ã®éƒ¨å±‹ååˆ— |
| `room.readingStatus` | âœ… 'completed'/'not-completed' | æ¤œé‡å®Œäº†çŠ¶æ³ |
| `room.isCompleted` | âœ… boolean | æ¤œé‡å®Œäº†ãƒ•ãƒ©ã‚° |
| `room.readingDateFormatted` | âœ… 'MæœˆDæ—¥' | ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¸ˆã¿æ¤œé‡æ—¥ |

#### æ¤œé‡å®Œäº†åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
```javascript
// inspection_data.csvã‹ã‚‰æ¤œé‡å®Œäº†ã‚’åˆ¤å®š
- ç‰©ä»¶IDä¸€è‡´
- ä»Šå›ã®æŒ‡ç¤ºæ•°ãŒå…¥åŠ›æ¸ˆã¿ï¼ˆnull/undefined/ç©ºæ–‡å­—ã§ãªã„ï¼‰
- æ¤œé‡æ—¥æ™‚ã‹ã‚‰æ—¥ä»˜ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆMæœˆDæ—¥å½¢å¼ï¼‰
```

## ä¿®æ­£å†…å®¹è©³ç´°

### 1. æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ä¿®æ­£
```javascript
// ä¿®æ­£å‰ï¼ˆã‚¨ãƒ©ãƒ¼ï¼‰
function getRooms(propertyId) {
  try {    const ss = SpreadsheetApp.getActiveSpreadsheet();

// ä¿®æ­£å¾Œï¼ˆæ­£å¸¸ï¼‰
function getRooms(propertyId) {
  try {
    const ss = SpreadsheetApp.getActiveSpreadsheet();
```

### 2. readingStatuså€¤ä¿®æ­£
```javascript
// ä¿®æ­£å‰
readingStatus: 'pending',

// ä¿®æ­£å¾Œï¼ˆHTMLãŒæœŸå¾…ã™ã‚‹å€¤ï¼‰
readingStatus: 'not-completed',
```

### 3. æ¤œé‡æ—¥æ™‚å‡¦ç†ã®æ”¹å–„
```javascript
// CSVå®Ÿéš›ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã«å¯¾å¿œ
const inspDateIndex = inspHeaders.indexOf('æ¤œé‡æ—¥æ™‚'); // 'æ¤œé‡æ—¥'â†’'æ¤œé‡æ—¥æ™‚'

// æ¤œé‡æ—¥ã‚’Mapã§ç®¡ç†ã—ã€å®Ÿéš›ã®æ—¥ä»˜ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨
const readingMap = new Map();
let readingDateFormatted = null;
if (inspDateIndex !== -1 && row[inspDateIndex]) {
  const date = new Date(row[inspDateIndex]);
  readingDateFormatted = `${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥`;
}
```

## ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ç¢ºèª

### 1. éƒ¨å±‹ãƒã‚¹ã‚¿.csv â†’ éƒ¨å±‹ä¸€è¦§
```
ç‰©ä»¶ID,éƒ¨å±‹ID,éƒ¨å±‹å
P000001,R000001,101
P000001,R000002,101
â†’ roomsé…åˆ—ã®åŸºæœ¬æƒ…å ±
```

### 2. inspection_data.csv â†’ æ¤œé‡çŠ¶æ³
```
ç‰©ä»¶ID,éƒ¨å±‹ID,ä»Šå›ã®æŒ‡ç¤ºæ•°,æ¤œé‡æ—¥æ™‚
P000001,R000001,1208,2025/05/31
P000001,R000002,1195,2025/05/27
â†’ æ¤œé‡å®Œäº†åˆ¤å®šã¨readingDateFormatted
```

### 3. HTMLè¡¨ç¤ºä¾‹
```
101 æ¤œé‡æ¸ˆã¿ï¼š5æœˆ31æ—¥
101 æ¤œé‡æ¸ˆã¿ï¼š5æœˆ27æ—¥
201 æœªæ¤œé‡
202 æœªæ¤œé‡
```

## ãƒ†ã‚¹ãƒˆæ‰‹é †

### 1. GASã§ã®ãƒ†ã‚¹ãƒˆ
```javascript
// Apps Scriptã‚¨ãƒ‡ã‚£ã‚¿ã§å®Ÿè¡Œ
debugGetRooms('P000001');
```

### 2. Web Appãƒ†ã‚¹ãƒˆ
```
https://script.google.com/.../exec?action=getRooms&propertyId=P000001
```

### 3. HTMLã§ã®å‹•ä½œç¢ºèª
```
room_select.html?propertyId=P000001
```

## æœŸå¾…ã•ã‚Œã‚‹çµæœ

### APIãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼
```json
{
  "success": true,
  "data": {
    "property": {
      "id": "P000001",
      "name": "ãƒ‘ãƒ«ãƒã‚¤ãƒ„å¹³ç”°"
    },
    "rooms": [
      {
        "id": "R000001",
        "name": "101",
        "hasReading": true,
        "readingStatus": "completed",
        "isCompleted": true,
        "readingDateFormatted": "5æœˆ31æ—¥"
      },
      {
        "id": "R000004",
        "name": "202",
        "hasReading": false,
        "readingStatus": "not-completed",
        "isCompleted": false,
        "readingDateFormatted": null
      }
    ]
  },
  "message": "4ä»¶ã®éƒ¨å±‹ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã—ãŸ"
}
```

### HTMLè¡¨ç¤ºçµæœ
- æ¤œé‡æ¸ˆã¿éƒ¨å±‹ï¼šç·‘è‰²èƒŒæ™¯ã€æ¤œé‡æ—¥è¡¨ç¤º
- æœªæ¤œé‡éƒ¨å±‹ï¼šé»„è‰²èƒŒæ™¯ã€ã€Œæœªæ¤œé‡ã€è¡¨ç¤º

## æ³¨æ„äº‹é …

1. **Web Appå†ãƒ‡ãƒ—ãƒ­ã‚¤å¿…é ˆ**: ä¿®æ­£å¾Œã¯å¿…ãšWeb Appã‚’å†ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ãã ã•ã„
2. **CSVæ§‹é€ ä¾å­˜**: éƒ¨å±‹ãƒã‚¹ã‚¿ãƒ»inspection_dataã®ãƒ˜ãƒƒãƒ€ãƒ¼æ§‹é€ ã«ä¾å­˜
3. **æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**: JavaScript Date()ã§è§£æå¯èƒ½ãªå½¢å¼ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™

## å®Œäº†çŠ¶æ³
- âœ… æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ä¿®æ­£å®Œäº†
- âœ… HTMLãƒ‡ãƒ¼ã‚¿å½¢å¼å¯¾å¿œå®Œäº†  
- âœ… CSVå®Ÿãƒ˜ãƒƒãƒ€ãƒ¼å¯¾å¿œå®Œäº†
- âœ… æ¤œé‡çŠ¶æ³åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯å®Œäº†
- âœ… ãƒ‡ãƒãƒƒã‚°é–¢æ•°æº–å‚™å®Œäº†
- ğŸ”„ Web Appå†ãƒ‡ãƒ—ãƒ­ã‚¤å¾…ã¡
- ğŸ”„ å®Ÿæ©Ÿã§ã®å‹•ä½œç¢ºèªå¾…ã¡

---
ä¿®æ­£å®Œäº†æ—¥: $(date)
æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—: Web Appã®å†ãƒ‡ãƒ—ãƒ­ã‚¤ã¨ç”»é¢ã§ã®å‹•ä½œç¢ºèª
