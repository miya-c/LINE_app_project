<!DOCTYPE html>
<html>
<head>
  <title>部屋選択</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; margin: 10px; }
    #room-list button { display: block; width: 100%; padding: 10px; margin-bottom: 5px; text-align: left; }
    .back-button { margin-bottom: 10px; padding: 8px 15px; }
  </style>
</head>
<body>
  <button class="back-button" onclick="history.back()">&lt; 物件選択に戻る</button>
  <h1 id="property-name-display">物件名 Loading...</h1>

  <div id="room-list">
    <p>部屋情報を読み込み中です...</p>
  </div>

  <script>
    // ページが読み込まれたら実行
    window.onload = function() {
      // URLから物件IDと物件名を取得
      const urlParams = new URLSearchParams(window.location.search);
      const propertyId = urlParams.get('propertyId');
      const propertyName = urlParams.get('propertyName');

      if (propertyName) {
        document.getElementById('property-name-display').textContent = propertyName;
      }

      if (propertyId) {
        fetchRooms(propertyId);
      } else {
        document.getElementById('room-list').innerHTML = '<p>物件が指定されていません。</p>';
      }
    };

    // GASから部屋リストを取得して表示する関数 (まだ中身は空)
    async function fetchRooms(propertyId) {
      const roomListDiv = document.getElementById('room-list');
      roomListDiv.innerHTML = `<p>${propertyId} の部屋情報を読み込み中です...</p>`;

      // ★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★
      // ★ ここに、部屋リストを取得するための新しいGASのウェブアプリURLが必要になるよ！ ★
      // ★ (まだ作ってないから、今は仮のURLを入れておくか、コメントアウトしておく)       ★
      // ★ ↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓ ★
      // ★ さっきGASをデプロイして取得した「部屋リスト取得用の新しいウェブアプリURL」をここに設定！ ★
      // ★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★
      const gasWebAppUrlForRoomsBase = 'https://script.google.com/macros/s/AKfycby0c-yVJ2uFRYYU9dHGwacSw6Qm92uLooENApA-Sqd74hdXmFYaViMncdGkyJFgO_Dw5Q/exec'; // 例: 'https://script.google.com/macros/s/yyyyyyyyyyyyyyyyy/exec'
      const gasWebAppUrlForRooms = `${gasWebAppUrlForRoomsBase}?propertyId=${propertyId}`;

      try {
        const response = await fetch(gasWebAppUrlForRooms);
        if (!response.ok) {
          throw new Error('ネットワークの応答が正しくありませんでした。');
        }
        const rooms = await response.json(); // GASから返ってきたJSONデータをJavaScriptのオブジェクトに変換

        roomListDiv.innerHTML = ''; // 「読み込み中です」やダミー表示を消す

        if (rooms.error) { // GAS側でエラーがあった場合 (例: 物件IDが指定されていない)
          roomListDiv.innerHTML = `<p>エラー: ${rooms.error}</p>`;
          return;
        }

        if (rooms.length === 0) {
          roomListDiv.innerHTML = `<p>この物件には登録されている部屋がありません。</p>`;
          return;
        }

        rooms.forEach(room => {
          const button = document.createElement('button');
          button.textContent = room.number; // 部屋番号を表示
          button.onclick = function() {
            // ここに部屋が選択された時の処理を書く (例: 指示数入力画面へ遷移)
            alert(`「${room.number}」が選択されました！ (部屋ID: ${room.id}, 物件ID: ${propertyId})`);
          };
          roomListDiv.appendChild(button);
        });
      } catch (error) {
        console.error('部屋情報の取得に失敗しました:', error);
        roomListDiv.innerHTML = '<p>部屋情報の取得に失敗しました。</p>';
      }
    }
  </script>
</body>
</html>